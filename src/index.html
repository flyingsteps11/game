<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="icon" href="favicon.ico" type="image/ico">
    <title>New project</title>
</head>
<body>
<div class="wrapper">
    <div class="score">
        <h1>Якудза</h1>
        <p>Ваш счёт<span id="score"></span></p>
    </div>
    <div id="path" class="path">
        <div id="block" class="block"></div>
        <div id="brick" class="brick"></div>
        <div id="gameover"></div>
    </div>
    <br>
    <div class="box">
        <div class="box__wrapper">
            <button onclick="movedown()">Начать</button>

            <button id="left" onclick='moveleft(brick)'>Лево</button>

            <button id="right" onclick='moveright(brick)'>Право</button>

            <button id="reset" onclick='reset()'>Ещё раз</button>
        </div>
    </div>
</div>
</body>
<script>
    const block = document.getElementById('block'),
        brick = document.getElementById('brick'),
        path = document.getElementById('path'),
        gameover = document.getElementById('gameover')
    var left = 10;
    brick.style.left = 20;
    brick.style.top = 380;
    block.style.top = 10;
    block.style.left = Math.floor((Math.random() * 390) + 5);
    block.style.backgroundColor = "purple";

    //двигаем телегу
    document.onkeydown = function () {
        switch (window.event.keyCode) {
            case 37:
                moveleft(brick);
                break;
            case 39:
                moveright(brick);
                break;
        }
    };

    //Расположение
    function moveright(elem) {
        function frame() {
            left = left + 20
            elem.style.left = left + 'px'
            clearInterval(id)
        }

        var id = setInterval(frame, 4)
    }

    function moveleft(elem) {
        function frame() {
            left = left - 20
            elem.style.left = left + 'px'
            clearInterval(id)
        }

        var id = setInterval(frame, 4)
    }

    var colors = ['pink', 'blue', 'purple', 'green', 'grey', 'yellow', 'orange']

    function movedown() {
        var top = 0

        function frame() {
            top++
            block.style.top = top + 'px'
            var blockRect = block.getBoundingClientRect(),
                brickRect = brick.getBoundingClientRect()
            if (block.style.top === '375px' && blockRect.right > brickRect.left && blockRect.left < brickRect.right) {
                clearInterval(id)
                updateScore()
                block.style.top = 10;
                block.style.left = 2000;
                block.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                movedown()
                console.log("Gamepad");
            }
            if (top == 400) {
                clearInterval(id);
                document.getElementById("gameover").innerHTML = "GAME OVER";
                console.log("Gamepad222");
            }
        }

        var id = setInterval(frame, 2)
    }

    var score = 0

    function updateScore() {
        score++
        document.getElementById("score").innerHTML = score;
    }

    function reset() {
        document.getElementById("gameover").innerHTML = "";
        score = 0
        document.getElementById("score").innerHTML = score;

    }

    // пока не работает
    document.addEventListener('touchstart', handleTouchStart, false);
    document.addEventListener('touchmove', handleTouchMove, false);

    var xDown = null;
    var yDown = null;

    function handleTouchStart(evt) {
        xDown = evt.touches[0].clientX;
        yDown = evt.touches[0].clientY;
    }

    function handleTouchMove(evt) {
        if (!xDown || !yDown) {
            return;
        }

        var xUp = evt.touches[0].clientX;
        var yUp = evt.touches[0].clientY;
        var xDiff = xDown - xUp;
        var yDiff = yDown - yUp;

        if (Math.abs(xDiff) > Math.abs(yDiff)) {
            if (xDiff > 0) {
                moveleft(brick)
                console.log('hi')
            } else {
                moveright(brick)
            }
        }
        xDown = null;
        yDown = null;
    }
</script>
</html>
